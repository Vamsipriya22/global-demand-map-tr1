<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Clickable World Map (No Antarctica)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://unpkg.com/maplibre-gl/dist/maplibre-gl.js"></script>
  <link href="https://unpkg.com/maplibre-gl/dist/maplibre-gl.css" rel="stylesheet" />
  <style>
    body { margin: 0; padding: 0; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }
  </style>
</head>
<body>
  <div id="map"></div>
  <script>
    // Create the Map
    const map = new maplibregl.Map({
      container: "map",
      style: "https://demotiles.maplibre.org/style.json", // Default MapLibre style
      center: [12, 44], // [Longitude, Latitude]
      zoom: 1.5,
      pitch: 0,
      bearing: 0,
      antialias: true,
    });

    // Sample demand data with country colors and links
    const countryData = {
      Algeria: {
        color: "#267326",
        link: "https://data.mendeley.com/datasets/z5x2d3mhw7/1",
      },
      Nigeria: {
        color: "#B2D8B2",
        link: "https://data.mendeley.com/datasets/pxvdm26rn7/2",
      },
      "South Africa": {
        color: "#67B367",
        link: "https://www.eskom.co.za/dataportal/data-request-form/",
      },
      "New Zealand": {
        color: "#0D400D",
        link: "https://www.emi.ea.govt.nz/Wholesale/Reports/W_GD_C",
      },
    };

    // Load country boundaries from GeoJSON
    map.on("load", function () {
      fetch("https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json")
        .then((response) => response.json())
        .then((data) => {
          // âœ… Remove Antarctica so it doesn't dominate the map
          data.features = data.features.filter(
            (f) => f.properties.name !== "Antarctica"
          );

          // Add countries source
          map.addSource("countries", {
            type: "geojson",
            data: data,
          });

          // Country fill layer
          map.addLayer({
            id: "country-fills",
            type: "fill",
            source: "countries",
            layout: {},
            paint: {
              "fill-color": [
                "match",
                ["get", "name"],
                ...Object.entries(countryData).flatMap(([name, info]) => [
                  name,
                  info.color,
                ]),
                "#AAAAAA", // Default gray for countries without data
              ],
              "fill-opacity": 1.0,
            },
          });

          // Country border layer
          map.addLayer({
            id: "country-borders",
            type: "line",
            source: "countries",
            layout: {},
            paint: {
              "line-color": "#000",
              "line-width": 1,
            },
          });

          // Click Event for Countries
          map.on("click", "country-fills", function (e) {
            const countryName = e.features[0].properties.name;
            const countryInfo = countryData[countryName];

            if (countryInfo) {
              window.open(countryInfo.link, "_blank"); // Open demand data link
            } else {
              alert("No demand data available for " + countryName);
            }
          });

          // Change cursor on hover
          map.on("mouseenter", "country-fills", function () {
            map.getCanvas().style.cursor = "pointer";
          });
          map.on("mouseleave", "country-fills", function () {
            map.getCanvas().style.cursor = "";
          });
        });
    });
  </script>
</body>
</html>
